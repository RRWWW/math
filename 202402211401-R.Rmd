# R

## TonyKuoYJ

::: {show-in="html"}
郭耀仁 認識 R 的美好
:::

::: {show-in="pdf"}
\begin{CJK}{UTF8}{bsmi}
郭耀仁 認識 R 的美好
\end{CJK}
:::

https://bookdown.org/tonykuoyj/eloquentr/getting-started.html

https://bookdown.org/tonykuoyj/eloquentr/easy-installation.html#about-packages

`install.pacakges()`

`library()`

https://bookdown.org/tonykuoyj/eloquentr/getting-started.html

### quick intro

`Ctrl + Alt + I` to insert a new code chunk in RStudio

`Ctrl + Enter` to run the current line

`Ctrl + Shift + Enter` to run the current chunk

```{r}
R.version
```


```{r}
a <- 23 # prime
a
```

```{r}
combine <- c(11, 13) # twin prime
combine
```

```{r}
# ?c
# help(c)
```

`Ctrl + L` to clean R console

path with slash `/` in R, differing backslash `\` in M$ Windows

#### function

```{r}
add <- function(x, y) {
  return(x + y)
}

add(11, 13)
```

$$
BMI = \dfrac{BW\left[\text{Kg}\right]}{{BH\left[\text{m}\right]}^2}
$$

```{r}
get_bmi <- function (bw, bh) {
  return (bw/(bh/100)^2)
}

get_bmi(70, 170)
```
### R style

https://bookdown.org/tonykuoyj/eloquentr/styleguide.html

snake_case rather than camelCase

### data workflow or forward pipe

from _chaining method_ in *object-oriented programming*
to **functional programming**

#### `%>%` operator

```{r}
abs(-5:5)
```


```{r}
# install.packages("magrittr")

library(magrittr)

-5:5 %>% abs()
```

```{r}
# with readability but too many lines
sys_date <- Sys.Date()
sys_date_yr <- format(sys_date, format = "%Y")
sys_date_num <- as.numeric(sys_date_yr)
sys_date_num
```

```{r}
# less line but also less readability
sys_date_num <- as.numeric(format(Sys.Date(), format = "%Y"))
sys_date_num
```
```{r}
# use %>% operator to demonstrate data workflow or forward pipe
sys_date_num <- Sys.Date() %>%
   format(format = "%Y") %>%
   as.numeric()
sys_date_num
```

### data processing with `dplyr`

https://bookdown.org/tonykuoyj/eloquentr/dplyr.html

some functions functioning like those in **SQL**

```{r, cache=FALSE}
library(dplyr)

# install.packages("gapminder")

library(gapminder)

head(gapminder)
```

```{r, cache=FALSE}
library(gapminder)
library(dplyr)
library(magrittr)

gapminder %>%
  filter(year == 2007)
```

```{r, cache=FALSE}
library(gapminder)
library(dplyr)
library(magrittr)

gapminder %>%
  filter(year == 2007) %>%
  select(country)
```

```{r, cache=FALSE}
library(gapminder)
library(dplyr)
library(magrittr)

gapminder %>%
  mutate(pop_in_thousands = pop / 1000)
```

```{r, cache=FALSE}
library(gapminder)
library(dplyr)
library(magrittr)

gapminder %>%
  arrange(year)
```

total population in the world in 2007

```{r, cache=FALSE}
library(gapminder)
library(dplyr)
library(magrittr)

gapminder %>%
  filter(year == 2007) %>%
  summarise(ttl_pop = sum(as.numeric(pop)))
```

total population group by the continents in 2007

```{r, cache=FALSE}
library(gapminder)
library(dplyr)
library(magrittr)

gapminder %>%
  filter(year == 2007) %>%
  group_by(continent) %>%
  summarise(ttl_pop = sum(as.numeric(pop)))
```

### visualization statically with `ggplot2`

```{r, cache=FALSE}
library(ggplot2)
library(gapminder)

gapminder_2007 <- gapminder %>%
  filter(year == 2007)
scatter_plot <- ggplot(gapminder_2007, aes(x = gdpPercap, y = lifeExp)) +
  geom_point()
scatter_plot
```

```{r, cache=FALSE}
library(ggplot2)
library(gapminder)

north_asia <- gapminder %>%
  filter(country %in% c("China", "Japan", "Taiwan", "Korea, Rep."))
line_plot <- ggplot(north_asia, aes(x = year, y = gdpPercap, colour = country)) +
  geom_line()
line_plot
```

```{r, cache=FALSE}
library(ggplot2)
library(gapminder)

hist_plot <- ggplot(gapminder_2007, aes(x = gdpPercap)) +
  geom_histogram()
hist_plot

hist_plot <- ggplot(gapminder_2007, aes(x = gdpPercap)) +
  geom_histogram(bins = 20)
hist_plot
```

```{r, cache=FALSE}
library(ggplot2)
library(gapminder)

box_plot <- ggplot(gapminder_2007, aes(x = continent, y = gdpPercap)) +
  geom_boxplot()
box_plot
```

```{r, cache=FALSE}
library(ggplot2)
library(gapminder)

gdpPercap_2007_na <- gapminder %>%
  filter(year == 2007 & country %in% c("China", "Japan", "Taiwan", "Korea, Rep."))
bar_plot <- ggplot(gdpPercap_2007_na, aes(x = country, y = gdpPercap)) +
  geom_bar(stat = "identity")
bar_plot
```

### loop

https://bookdown.org/tonykuoyj/eloquentr/for.html

```{r}
month.name
```

```{r}
month.name[1]
```

```{r}
for (month in month.name) {
  print(month)
}
```

### variable type

https://bookdown.org/tonykuoyj/eloquentr/variable-types.html

https://www.w3schools.com/r/r_data_types.asp

- numeric
- integer
- complex =  complex number
- character
- logical = boolean

```{r}
class(2L)
class(2.0L)
class(2.3L)
```
time: POSIXct POSIXt
```{r}
class(Sys.time())
```

```{r}
0 %in% -5:5
```
#### date

1970-01-01 = 0L

```{r}
date_of_origin <- as.Date("1970-01-01")
as.integer(date_of_origin)
```
check if type of `x` is `Date`

`inherits(x, what = "Date")`

convert `character` to `Date`

`as.Date("01-01-1970", format = "%m-%d-%Y")`

#### time

1970-01-01 00:00:00 GMT = 0L

tz = time zone

```{r}
time_of_origin <- as.POSIXct("1970-01-01 00:00:00", tz = "GMT")
as.integer(time_of_origin)
```
check if type of `x` is time

`inherits(x, what = "POSIXct")`

convert `character` to time

`as.POSIXct("1970-01-01 00:00:00", tz = "GMT")`


#### quotient `%/%` operator

https://www.w3schools.com/r/r_operators.asp

```{r}
7 %/% 3
```

### data type

https://bookdown.org/tonykuoyj/eloquentr/vector-factor.html

- 1D
  - [vector]^[\@ref(vector)]^
  - [factor]^[\@ref(factor)]^
- 2D
  - [matrix]^[\@ref(matrix)]^
  - [data frame]^[\@ref(data-frame)]^
- $n$D
  - [array]^[\@ref(array)]^
  - [list]^[\@ref(list)]^
  
#### vector

```{r}
four_seasons <- c("spring", "summer", "autumn", "winter")
four_seasons
favorite_season <- four_seasons[3]
favorite_season
favorite_seasons <- four_seasons[c(-2, -4)]
favorite_seasons
```

only one variable type for a vector

```{r}
lucky_numbers <- c(7L, 24)
class(lucky_numbers[1])
```

```{r}
lucky_numbers <- c(7L, FALSE)
lucky_numbers
class(lucky_numbers[2])
```

```{r}
mixed_vars <- c(TRUE, 7L, 24, "spring")
mixed_vars
class(mixed_vars[1])
class(mixed_vars[2])
class(mixed_vars[3])
```

##### logic

```{r}
four_seasons <- c("spring", "summer", "autumn", "winter")
my_favorite_seasons <- four_seasons == "spring" | four_seasons == "autumn"
four_seasons[my_favorite_seasons]
```

##### `rep` repeat

```{r}
rep(7L, times = 8)
```

```{r}
rep("R", times = 10)
```
##### `seq` sequence

```{r}
seq(from = 7, to = 77, by = 7)
```

```{r}
11:20
```

#### factor

https://bookdown.org/tonykuoyj/eloquentr/vector-factor.html#factor

```{r}
four_seasons <- c("spring", "summer", "autumn", "winter")
four_seasons
```

```{r}
four_seasons_factor <- factor(four_seasons)
four_seasons_factor
```

```{r}
four_seasons <- c("spring", "summer", "autumn", "winter")
four_seasons_factor <- factor(four_seasons, ordered = TRUE, levels = c("summer", "winter", "spring", "autumn"))
four_seasons_factor
```

```{r}
temperatures <- c("warm", "hot", "cold")
temp_factors <- factor(temperatures, ordered = TRUE, levels = c("cold", "warm", "hot"))
temp_factors
```
if no levels specified, the levels will be specified alphabetically, sometimes not really true

```{r}
temperatures <- c("warm", "hot", "cold")
temp_factors <- factor(temperatures, ordered = TRUE)
temp_factors
```
#### matrix

https://bookdown.org/tonykuoyj/eloquentr/matrix-dataframe-more.html

```{r}
my_mat <- matrix(1:6, nrow = 2)
my_mat
```
```{r}
class(my_mat)
```

```{r}
my_mat2 <- matrix(1:6, nrow = 2, byrow = TRUE)
my_mat2
```

```{r}
my_mat2[2, 3]
```

```{r}
my_mat2[2, ]
```

```{r}
my_mat2[, 3]
```

```{r}
filter <- my_mat2 < 6 & my_mat2 > 1
my_mat2[filter]
```
boolean will become value in a matrix, like vector

```{r}
my_mat3 <- matrix(c(1, 2, TRUE, FALSE, 3, 4), nrow = 2)
my_mat3
```

```{r}
class(my_mat3[, 2])
```
#### data frame

- variable: column
- observation: row
- value: cell

::: {show-in="html"}
<center>
![](https://ismayc.github.io/moderndiver-book/images/tidy-1.png)
</center>
:::

```{r}
team_name <- c("Chicago Bulls", "Golden State Warriors")
wins <- c(72, 73)
losses <- c(10, 9)
is_champion <- c(TRUE, FALSE)
season <- c("1995-96", "2015-16")

great_nba_teams <- data.frame(team_name, wins, losses, is_champion, season)
great_nba_teams
```

```{r}
great_nba_teams[1, 1]
```

```{r}
great_nba_teams[1, ]
```

```{r}
great_nba_teams[, 1]
```
`stringsAsFactors = TRUE`

```{r}
team_name <- c("Chicago Bulls", "Golden State Warriors")
wins <- c(72, 73)
losses <- c(10, 9)
is_champion <- c(TRUE, FALSE)
season <- c("1995-96", "2015-16")
 
great_nba_teams <- data.frame(team_name, wins, losses, is_champion, season, stringsAsFactors = TRUE)
great_nba_teams[, 1]
```

`stringsAsFactors = FALSE`

```{r}
team_name <- c("Chicago Bulls", "Golden State Warriors")
wins <- c(72, 73)
losses <- c(10, 9)
is_champion <- c(TRUE, FALSE)
season <- c("1995-96", "2015-16")
 
great_nba_teams <- data.frame(team_name, wins, losses, is_champion, season, stringsAsFactors = FALSE)
great_nba_teams[, 1]
```
##### selecting variable or column

```{r}
great_nba_teams$team_name
```

```{r}
great_nba_teams[, "team_name"]
```
##### filtering observation or row

```{r}
filter <- great_nba_teams$is_champion == TRUE
great_nba_teams[filter, ]
```

##### check mixed data type

```{r}
str(great_nba_teams)
```

## W3School

https://www.w3schools.com/r/default.asp

### same multiple variable

https://www.w3schools.com/r/r_variables_multiple.asp

```{r}
# Assign the same value to multiple variables in one line
var1 <- var2 <- var3 <- "Orange"

# Print variable values
var1
var2
var3
```
### legal variable name

https://www.w3schools.com/r/r_variables_name.asp

```{r}
# Legal variable names:
myvar <- "John"
my_var <- "John"
myVar <- "John"
MYVAR <- "John"
myvar2 <- "John"
.myvar <- "John"

## Illegal variable names:
# 2myvar <- "John"
# my-var <- "John"
# my var <- "John"
# _my_var <- "John"
# my_v@ar <- "John"
# TRUE <- "John"
```
### complex number

https://www.w3schools.com/r/r_data_types.asp

https://www.w3schools.com/r/r_numbers.asp

### escape character

https://www.w3schools.com/r/r_strings_esc.asp

### global assignment `<<-`

```{r}
my_function <- function() {
txt <<- "fantastic"
  paste("R is", txt)
}

my_function()

print(txt)
```

```{r}
txt <- "awesome"
my_function <- function() {
  txt <<- "fantastic"
  paste("R is", txt)
}

my_function()

paste("R is", txt)
```
### data type

#### array

https://www.w3schools.com/r/r_arrays.asp

```{r}
# An array with one dimension with values ranging from 1 to 24
thisarray <- c(1:24)
thisarray

# An array with more than one dimension
multiarray <- array(thisarray, dim = c(4, 3, 2))
multiarray
```

```{r}
multiarray[2, 3, 2]
```

#### list

https://www.w3schools.com/r/r_lists.asp

## Apan Liao

::: {show-in="html"}

R 演習室

:::

::: {show-in="pdf"}

\begin{CJK}{UTF8}{bsmi}
R 演習室
\end{CJK}

:::

https://www.youtube.com/playlist?list=PL5AC0ADBF65924EAD

### data input

https://www.youtube.com/watch?v=STcIxf_vUWY&list=PL5AC0ADBF65924EAD&index=1

- `scan()`
- read
  - `read.table()`
  - `read.csv()`
  
### descriptive statistics

https://www.youtube.com/watch?v=GL3Wv_45LaU&list=PL5AC0ADBF65924EAD&index=2
